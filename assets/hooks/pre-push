#!/bin/sh
set -e

ROOT="$(git rev-parse --show-toplevel 2>/dev/null || true)"
if [ -z "$ROOT" ]; then
  exit 0
fi
cd "$ROOT"

if ! command -v git-ai >/dev/null 2>&1; then
  exit 0
fi

git-ai ai pack -p "$ROOT" >/dev/null

CHANGED="$(git status --porcelain -- .git-ai/lancedb.tar.gz .gitattributes 2>/dev/null || true)"
if [ -n "$CHANGED" ]; then
  echo "git-ai: .git-ai/lancedb.tar.gz changed during pre-push; please commit it before pushing." 1>&2
  exit 1
fi

